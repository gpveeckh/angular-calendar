import * as tslib_1 from "tslib";
import { validateEvents as validateEventsWithoutLog } from 'calendar-utils';
export var validateEvents = function (events) {
    var warn = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        return console.warn.apply(console, tslib_1.__spread(['angular-calendar'], args));
    };
    return validateEventsWithoutLog(events, warn);
};
export function isInside(outer, inner) {
    return (Math.floor(outer.left) <= Math.ceil(inner.left) &&
        Math.floor(inner.left) <= Math.ceil(outer.right) &&
        Math.floor(outer.left) <= Math.ceil(inner.right) &&
        Math.floor(inner.right) <= Math.ceil(outer.right) &&
        Math.floor(outer.top) <= Math.ceil(inner.top) &&
        Math.floor(inner.top) <= Math.ceil(outer.bottom) &&
        Math.floor(outer.top) <= Math.ceil(inner.bottom) &&
        Math.floor(inner.bottom) <= Math.ceil(outer.bottom));
}
export function roundToNearest(amount, precision) {
    return Math.round(amount / precision) * precision;
}
export var trackByEventId = function (index, event) {
    return event.id ? event.id : event;
};
export var trackByWeekDayHeaderDate = function (index, day) {
    return day.date.toISOString();
};
export var trackByHourSegment = function (index, segment) { return segment.date.toISOString(); };
export var trackByHour = function (index, hour) {
    return hour.segments[0].date.toISOString();
};
export var trackByWeekAllDayEvent = function (index, weekEvent) { return (weekEvent.event.id ? weekEvent.event.id : weekEvent.event); };
export var trackByWeekTimeEvent = function (index, weekEvent) { return (weekEvent.event.id ? weekEvent.event.id : weekEvent.event); };
var MINUTES_IN_HOUR = 60;
function getPixelAmountInMinutes(hourSegments, hourSegmentHeight) {
    return MINUTES_IN_HOUR / (hourSegments * hourSegmentHeight);
}
export function getMinutesMoved(movedY, hourSegments, hourSegmentHeight, eventSnapSize) {
    var draggedInPixelsSnapSize = roundToNearest(movedY, eventSnapSize || hourSegmentHeight);
    var pixelAmountInMinutes = getPixelAmountInMinutes(hourSegments, hourSegmentHeight);
    return draggedInPixelsSnapSize * pixelAmountInMinutes;
}
export function getMinimumEventHeightInMinutes(hourSegments, hourSegmentHeight) {
    return (getPixelAmountInMinutes(hourSegments, hourSegmentHeight) * hourSegmentHeight);
}
export function getDefaultEventEnd(dateAdapter, event, minimumMinutes) {
    if (event.end) {
        return event.end;
    }
    else {
        return dateAdapter.addMinutes(event.start, minimumMinutes);
    }
}
export function addDaysWithExclusions(dateAdapter, date, days, excluded) {
    var daysCounter = 0;
    var daysToAdd = 0;
    var changeDays = days < 0 ? dateAdapter.subDays : dateAdapter.addDays;
    var result = date;
    while (daysToAdd <= Math.abs(days)) {
        result = changeDays(date, daysCounter);
        var day = dateAdapter.getDay(result);
        if (excluded.indexOf(day) === -1) {
            daysToAdd++;
        }
        daysCounter++;
    }
    return result;
}
export function isDraggedWithinPeriod(newStart, newEnd, period) {
    var end = newEnd || newStart;
    return ((period.start <= newStart && newStart <= period.end) ||
        (period.start <= end && end <= period.end));
}
export function shouldFireDroppedEvent(dropEvent, date, allDay, calendarId) {
    return (dropEvent.dropData &&
        dropEvent.dropData.event &&
        (dropEvent.dropData.calendarId !== calendarId ||
            (dropEvent.dropData.event.allDay && !allDay) ||
            (!dropEvent.dropData.event.allDay && allDay)));
}
export function getWeekViewPeriod(dateAdapter, viewDate, weekStartsOn, excluded, daysInWeek) {
    if (excluded === void 0) { excluded = []; }
    var viewStart = daysInWeek
        ? dateAdapter.startOfDay(viewDate)
        : dateAdapter.startOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    var endOfWeek = dateAdapter.endOfWeek(viewDate, { weekStartsOn: weekStartsOn });
    while (excluded.indexOf(dateAdapter.getDay(viewStart)) > -1 &&
        viewStart < endOfWeek) {
        viewStart = dateAdapter.addDays(viewStart, 1);
    }
    if (daysInWeek) {
        var viewEnd = dateAdapter.endOfDay(addDaysWithExclusions(dateAdapter, viewStart, daysInWeek - 1, excluded));
        return { viewStart: viewStart, viewEnd: viewEnd };
    }
    else {
        var viewEnd = endOfWeek;
        while (excluded.indexOf(dateAdapter.getDay(viewEnd)) > -1 &&
            viewEnd > viewStart) {
            viewEnd = dateAdapter.subDays(viewEnd, 1);
        }
        return { viewStart: viewStart, viewEnd: viewEnd };
    }
}
export function isWithinThreshold(_a) {
    var x = _a.x, y = _a.y;
    var DRAG_THRESHOLD = 1;
    return Math.abs(x) > DRAG_THRESHOLD || Math.abs(y) > DRAG_THRESHOLD;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FuZ3VsYXItY2FsZW5kYXIvIiwic291cmNlcyI6WyJtb2R1bGVzL2NvbW1vbi91dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBS0wsY0FBYyxJQUFJLHdCQUF3QixFQUkzQyxNQUFNLGdCQUFnQixDQUFDO0FBR3hCLE1BQU0sQ0FBQyxJQUFNLGNBQWMsR0FBRyxVQUFDLE1BQXVCO0lBQ3BELElBQU0sSUFBSSxHQUFHO1FBQUMsY0FBTzthQUFQLFVBQU8sRUFBUCxxQkFBTyxFQUFQLElBQU87WUFBUCx5QkFBTzs7UUFBSyxPQUFBLE9BQU8sQ0FBQyxJQUFJLE9BQVosT0FBTyxvQkFBTSxrQkFBa0IsR0FBSyxJQUFJO0lBQXhDLENBQXlDLENBQUM7SUFDcEUsT0FBTyx3QkFBd0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDaEQsQ0FBQyxDQUFDO0FBRUYsTUFBTSxVQUFVLFFBQVEsQ0FBQyxLQUFpQixFQUFFLEtBQWlCO0lBQzNELE9BQU8sQ0FDTCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDL0MsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQ2hELElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQztRQUNoRCxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFDakQsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFD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QyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDcEQsU0FBUyxHQUFHLFNBQVMsRUFDckI7UUFDQSxTQUFTLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDL0M7SUFDRCxJQUFJLFVBQVUsRUFBRTtRQUNkLElBQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxRQUFRLENBQ2xDLHFCQUFxQixDQUFDLFdBQVcsRUFBRSxTQUFTLEVBQUUsVUFBVSxHQUFHLENBQUMsRUFBRSxRQUFRLENBQUMsQ0FDeEUsQ0FBQztRQUNGLE9BQU8sRUFBRSxTQUFTLFdBQUEsRUFBRSxPQUFPLFNBQUEsRUFBRSxDQUFDO0tBQy9CO1NBQU07UUFDTCxJQUFJLE9BQU8sR0FBRyxTQUFTLENBQUM7UUFDeEIsT0FDRSxRQUFRLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbEQsT0FBTyxHQUFHLFNBQVMsRUFDbkI7WUFDQSxPQUFPLEdBQUcsV0FBVyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7U0FDM0M7UUFDRCxPQUFPLEVBQUUsU0FBUyxXQUFBLEVBQUUsT0FBTyxTQUFBLEVBQUUsQ0FBQztLQUMvQjtBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsaUJBQWlCLENBQUMsRUFBa0M7UUFBaEMsUUFBQyxFQUFFLFFBQUM7SUFDdEMsSUFBTSxjQUFjLEdBQUcsQ0FBQyxDQUFDO0lBQ3pCLE9BQU8sSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxjQUFjLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxjQUFjLENBQUM7QUFDdEUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQ2FsZW5kYXJFdmVudCxcclxuICBXZWVrVmlld1RpbWVFdmVudCxcclxuICBXZWVrVmlld0hvdXIsXHJcbiAgV2Vla1ZpZXdIb3VyU2VnbWVudCxcclxuICB2YWxpZGF0ZUV2ZW50cyBhcyB2YWxpZGF0ZUV2ZW50c1dpdGhvdXRMb2csXHJcbiAgVmlld1BlcmlvZCxcclxuICBXZWVrRGF5LFxyXG4gIFdlZWtWaWV3QWxsRGF5RXZlbnRcclxufSBmcm9tICdjYWxlbmRhci11dGlscyc7XHJcbmltcG9ydCB7IERhdGVBZGFwdGVyIH0gZnJvbSAnLi4vLi4vZGF0ZS1hZGFwdGVycy9kYXRlLWFkYXB0ZXInO1xyXG5cclxuZXhwb3J0IGNvbnN0IHZhbGlkYXRlRXZlbnRzID0gKGV2ZW50czogQ2FsZW5kYXJFdmVudFtdKSA9PiB7XHJcbiAgY29uc3Qgd2FybiA9ICguLi5hcmdzKSA9PiBjb25zb2xlLndhcm4oJ2FuZ3VsYXItY2FsZW5kYXInLCAuLi5hcmdzKTtcclxuICByZXR1cm4gdmFsaWRhdGVFdmVudHNXaXRob3V0TG9nKGV2ZW50cywgd2Fybik7XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNJbnNpZGUob3V0ZXI6IENsaWVudFJlY3QsIGlubmVyOiBDbGllbnRSZWN0KTogYm9vbGVhbiB7XHJcbiAgcmV0dXJuIChcclxuICAgIE1hdGguZmxvb3Iob3V0ZXIubGVmdCkgPD0gTWF0aC5jZWlsKGlubmVyLmxlZnQpICYmXHJcbiAgICBNYXRoLmZsb29yKGlubmVyLmxlZnQpIDw9IE1hdGguY2VpbChvdXRlci5yaWdodCkgJiZcclxuICAgIE1hdGguZmxvb3Iob3V0ZXIubGVmdCkgPD0gTWF0aC5jZWlsKGlubmVyLnJpZ2h0KSAmJlxyXG4gICAgTWF0aC5mbG9vcihpbm5lci5yaWdodCkgPD0gTWF0aC5jZWlsKG91dGVyLnJpZ2h0KSAmJlxyXG4gICAgTWF0aC5mbG9vcihvdXRlci50b3ApIDw9IE1hdGguY2VpbChpbm5lci50b3ApICYmXHJcbiAgICBNYXRoLmZsb29yKGlubmVyLnRvcCkgPD0gTWF0aC5jZWlsKG91dGVyLmJvdHRvbSkgJiZcclxuICAgIE1hdGguZmxvb3Iob3V0ZXIudG9wKSA8PSBNYXRoLmNlaWwoaW5uZXIuYm90dG9tKSAmJlxyXG4gICAgTWF0aC5mbG9vcihpbm5lci5ib3R0b20pIDw9IE1hdGguY2VpbChvdXRlci5ib3R0b20pXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJvdW5kVG9OZWFyZXN0KGFtb3VudDogbnVtYmVyLCBwcmVjaXNpb246IG51bWJlcikge1xyXG4gIHJldHVybiBNYXRoLnJvdW5kKGFtb3VudCAvIHByZWNpc2lvbikgKiBwcmVjaXNpb247XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCB0cmFja0J5RXZlbnRJZCA9IChpbmRleDogbnVtYmVyLCBldmVudDogQ2FsZW5kYXJFdmVudCkgPT5cclxuICBldmVudC5pZCA/IGV2ZW50LmlkIDogZXZlbnQ7XHJcblxyXG5leHBvcnQgY29uc3QgdHJhY2tCeVdlZWtEYXlIZWFkZXJEYXRlID0gKGluZGV4OiBudW1iZXIsIGRheTogV2Vla0RheSkgPT5cclxuICBkYXkuZGF0ZS50b0lTT1N0cmluZygpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHRyYWNrQnlIb3VyU2VnbWVudCA9IChcclxuICBpbmRleDogbnVtYmVyLFxyXG4gIHNlZ21lbnQ6IFdlZWtWaWV3SG91clNlZ21lbnRcclxuKSA9PiBzZWdtZW50LmRhdGUudG9JU09TdHJpbmcoKTtcclxuXHJcbmV4cG9ydCBjb25zdCB0cmFja0J5SG91ciA9IChpbmRleDogbnVtYmVyLCBob3VyOiBXZWVrVmlld0hvdXIpID0+XHJcbiAgaG91ci5zZWdtZW50c1swXS5kYXRlLnRvSVNPU3RyaW5nKCk7XHJcblxyXG5leHBvcnQgY29uc3QgdHJhY2tCeVdlZWtBbGxEYXlFdmVudCA9IChcclxuICBpbmRleDogbnVtYmVyLFxyXG4gIHdlZWtFdmVudDogV2Vla1ZpZXdBbGxEYXlFdmVudFxyXG4pID0+ICh3ZWVrRXZlbnQuZXZlbnQuaWQgPyB3ZWVrRXZlbnQuZXZlbnQuaWQgOiB3ZWVrRXZlbnQuZXZlbnQpO1xyXG5cclxuZXhwb3J0IGNvbnN0IHRyYWNrQnlXZWVrVGltZUV2ZW50ID0gKFxyXG4gIGluZGV4OiBudW1iZXIsXHJcbiAgd2Vla0V2ZW50OiBXZWVrVmlld1RpbWVFdmVudFxyXG4pID0+ICh3ZWVrRXZlbnQuZXZlbnQuaWQgPyB3ZWVrRXZlbnQuZXZlbnQuaWQgOiB3ZWVrRXZlbnQuZXZlbnQpO1xyXG5cclxuY29uc3QgTUlOVVRFU19JTl9IT1VSID0gNjA7XHJcblxyXG5mdW5jdGlvbiBnZXRQaXhlbEFtb3VudEluTWludXRlcyhcclxuICBob3VyU2VnbWVudHM6IG51bWJlcixcclxuICBob3VyU2VnbWVudEhlaWdodDogbnVtYmVyXHJcbikge1xyXG4gIHJldHVybiBNSU5VVEVTX0lOX0hPVVIgLyAoaG91clNlZ21lbnRzICogaG91clNlZ21lbnRIZWlnaHQpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0TWludXRlc01vdmVkKFxyXG4gIG1vdmVkWTogbnVtYmVyLFxyXG4gIGhvdXJTZWdtZW50czogbnVtYmVyLFxyXG4gIGhvdXJTZWdtZW50SGVpZ2h0OiBudW1iZXIsXHJcbiAgZXZlbnRTbmFwU2l6ZTogbnVtYmVyXHJcbik6IG51bWJlciB7XHJcbiAgY29uc3QgZHJhZ2dlZEluUGl4ZWxzU25hcFNpemUgPSByb3VuZFRvTmVhcmVzdChcclxuICAgIG1vdmVkWSxcclxuICAgIGV2ZW50U25hcFNpemUgfHwgaG91clNlZ21lbnRIZWlnaHRcclxuICApO1xyXG4gIGNvbnN0IHBpeGVsQW1vdW50SW5NaW51dGVzID0gZ2V0UGl4ZWxBbW91bnRJbk1pbnV0ZXMoXHJcbiAgICBob3VyU2VnbWVudHMsXHJcbiAgICBob3VyU2VnbWVudEhlaWdodFxyXG4gICk7XHJcbiAgcmV0dXJuIGRyYWdnZWRJblBpeGVsc1NuYXBTaXplICogcGl4ZWxBbW91bnRJbk1pbnV0ZXM7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRNaW5pbXVtRXZlbnRIZWlnaHRJbk1pbnV0ZXMoXHJcbiAgaG91clNlZ21lbnRzOiBudW1iZXIsXHJcbiAgaG91clNlZ21lbnRIZWlnaHQ6IG51bWJlclxyXG4pIHtcclxuICByZXR1cm4gKFxyXG4gICAgZ2V0UGl4ZWxBbW91bnRJbk1pbnV0ZXMoaG91clNlZ21lbnRzLCBob3VyU2VnbWVudEhlaWdodCkgKiBob3VyU2VnbWVudEhlaWdodFxyXG4gICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0RXZlbnRFbmQoXHJcbiAgZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyLFxyXG4gIGV2ZW50OiBDYWxlbmRhckV2ZW50LFxyXG4gIG1pbmltdW1NaW51dGVzOiBudW1iZXJcclxuKTogRGF0ZSB7XHJcbiAgaWYgKGV2ZW50LmVuZCkge1xyXG4gICAgcmV0dXJuIGV2ZW50LmVuZDtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIGRhdGVBZGFwdGVyLmFkZE1pbnV0ZXMoZXZlbnQuc3RhcnQsIG1pbmltdW1NaW51dGVzKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhZGREYXlzV2l0aEV4Y2x1c2lvbnMoXHJcbiAgZGF0ZUFkYXB0ZXI6IERhdGVBZGFwdGVyLFxyXG4gIGRhdGU6IERhdGUsXHJcbiAgZGF5czogbnVtYmVyLFxyXG4gIGV4Y2x1ZGVkOiBudW1iZXJbXVxyXG4pOiBEYXRlIHtcclxuICBsZXQgZGF5c0NvdW50ZXIgPSAwO1xyXG4gIGxldCBkYXlzVG9BZGQgPSAwO1xyXG4gIGNvbnN0IGNoYW5nZURheXMgPSBkYXlzIDwgMCA/IGRhdGVBZGFwdGVyLnN1YkRheXMgOiBkYXRlQWRhcHRlci5hZGREYXlzO1xyXG4gIGxldCByZXN1bHQgPSBkYXRlO1xyXG4gIHdoaWxlIChkYXlzVG9BZGQgPD0gTWF0aC5hYnMoZGF5cykpIHtcclxuICAgIHJlc3VsdCA9IGNoYW5nZURheXMoZGF0ZSwgZGF5c0NvdW50ZXIpO1xyXG4gICAgY29uc3QgZGF5ID0gZGF0ZUFkYXB0ZXIuZ2V0RGF5KHJlc3VsdCk7XHJcbiAgICBpZiAoZXhjbHVkZWQuaW5kZXhPZihkYXkpID09PSAtMSkge1xyXG4gICAgICBkYXlzVG9BZGQrKztcclxuICAgIH1cclxuICAgIGRheXNDb3VudGVyKys7XHJcbiAgfVxyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBpc0RyYWdnZWRXaXRoaW5QZXJpb2QoXHJcbiAgbmV3U3RhcnQ6IERhdGUsXHJcbiAgbmV3RW5kOiBEYXRlLFxyXG4gIHBlcmlvZDogVmlld1BlcmlvZFxyXG4pOiBib29sZWFuIHtcclxuICBjb25zdCBlbmQgPSBuZXdFbmQgfHwgbmV3U3RhcnQ7XHJcbiAgcmV0dXJuIChcclxuICAgIChwZXJpb2Quc3RhcnQgPD0gbmV3U3RhcnQgJiYgbmV3U3RhcnQgPD0gcGVyaW9kLmVuZCkgfHxcclxuICAgIChwZXJpb2Quc3RhcnQgPD0gZW5kICYmIGVuZCA8PSBwZXJpb2QuZW5kKVxyXG4gICk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzaG91bGRGaXJlRHJvcHBlZEV2ZW50KFxyXG4gIGRyb3BFdmVudDogeyBkcm9wRGF0YT86IHsgZXZlbnQ/OiBDYWxlbmRhckV2ZW50OyBjYWxlbmRhcklkPzogc3ltYm9sIH0gfSxcclxuICBkYXRlOiBEYXRlLFxyXG4gIGFsbERheTogYm9vbGVhbixcclxuICBjYWxlbmRhcklkOiBzeW1ib2xcclxuKSB7XHJcbiAgcmV0dXJuIChcclxuICAgIGRyb3BFdmVudC5kcm9wRGF0YSAmJlxyXG4gICAgZHJvcEV2ZW50LmRyb3BEYXRhLmV2ZW50ICYmXHJcbiAgICAoZHJvcEV2ZW50LmRyb3BEYXRhLmNhbGVuZGFySWQgIT09IGNhbGVuZGFySWQgfHxcclxuICAgICAgKGRyb3BFdmVudC5kcm9wRGF0YS5ldmVudC5hbGxEYXkgJiYgIWFsbERheSkgfHxcclxuICAgICAgKCFkcm9wRXZlbnQuZHJvcERhdGEuZXZlbnQuYWxsRGF5ICYmIGFsbERheSkpXHJcbiAgKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFdlZWtWaWV3UGVyaW9kKFxyXG4gIGRhdGVBZGFwdGVyOiBEYXRlQWRhcHRlcixcclxuICB2aWV3RGF0ZTogRGF0ZSxcclxuICB3ZWVrU3RhcnRzT246IG51bWJlcixcclxuICBleGNsdWRlZDogbnVtYmVyW10gPSBbXSxcclxuICBkYXlzSW5XZWVrPzogbnVtYmVyXHJcbik6IHsgdmlld1N0YXJ0OiBEYXRlOyB2aWV3RW5kOiBEYXRlIH0ge1xyXG4gIGxldCB2aWV3U3RhcnQgPSBkYXlzSW5XZWVrXHJcbiAgICA/IGRhdGVBZGFwdGVyLnN0YXJ0T2ZEYXkodmlld0RhdGUpXHJcbiAgICA6IGRhdGVBZGFwdGVyLnN0YXJ0T2ZXZWVrKHZpZXdEYXRlLCB7IHdlZWtTdGFydHNPbiB9KTtcclxuICBjb25zdCBlbmRPZldlZWsgPSBkYXRlQWRhcHRlci5lbmRPZldlZWsodmlld0RhdGUsIHsgd2Vla1N0YXJ0c09uIH0pO1xyXG4gIHdoaWxlIChcclxuICAgIGV4Y2x1ZGVkLmluZGV4T2YoZGF0ZUFkYXB0ZXIuZ2V0RGF5KHZpZXdTdGFydCkpID4gLTEgJiZcclxuICAgIHZpZXdTdGFydCA8IGVuZE9mV2Vla1xyXG4gICkge1xyXG4gICAgdmlld1N0YXJ0ID0gZGF0ZUFkYXB0ZXIuYWRkRGF5cyh2aWV3U3RhcnQsIDEpO1xyXG4gIH1cclxuICBpZiAoZGF5c0luV2Vlaykge1xyXG4gICAgY29uc3Qgdmlld0VuZCA9IGRhdGVBZGFwdGVyLmVuZE9mRGF5KFxyXG4gICAgICBhZGREYXlzV2l0aEV4Y2x1c2lvbnMoZGF0ZUFkYXB0ZXIsIHZpZXdTdGFydCwgZGF5c0luV2VlayAtIDEsIGV4Y2x1ZGVkKVxyXG4gICAgKTtcclxuICAgIHJldHVybiB7IHZpZXdTdGFydCwgdmlld0VuZCB9O1xyXG4gIH0gZWxzZSB7XHJcbiAgICBsZXQgdmlld0VuZCA9IGVuZE9mV2VlaztcclxuICAgIHdoaWxlIChcclxuICAgICAgZXhjbHVkZWQuaW5kZXhPZihkYXRlQWRhcHRlci5nZXREYXkodmlld0VuZCkpID4gLTEgJiZcclxuICAgICAgdmlld0VuZCA+IHZpZXdTdGFydFxyXG4gICAgKSB7XHJcbiAgICAgIHZpZXdFbmQgPSBkYXRlQWRhcHRlci5zdWJEYXlzKHZpZXdFbmQsIDEpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHsgdmlld1N0YXJ0LCB2aWV3RW5kIH07XHJcbiAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNXaXRoaW5UaHJlc2hvbGQoeyB4LCB5IH06IHsgeDogbnVtYmVyOyB5OiBudW1iZXIgfSkge1xyXG4gIGNvbnN0IERSQUdfVEhSRVNIT0xEID0gMTtcclxuICByZXR1cm4gTWF0aC5hYnMoeCkgPiBEUkFHX1RIUkVTSE9MRCB8fCBNYXRoLmFicyh5KSA+IERSQUdfVEhSRVNIT0xEO1xyXG59XHJcbiJdfQ==